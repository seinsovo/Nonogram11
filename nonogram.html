<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°ç»‡æ¸¸æˆ (Nonogram)</title>
    <style>
        :root {
            --cell-size: 30px;
            --border-color: #333;
            --filled-color: #2c3e50;
            --x-color: #e74c3c;
            --bg-color: #f4f4f4;
            --highlight-color: #e0e0e0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--bg-color);
            color: #333;
            margin: 0;
            padding: 20px;
            user-select: none; /* é˜²æ­¢æ‹–æ‹½æ—¶é€‰ä¸­æ–‡æœ¬ */
        }

        h1 { margin-bottom: 10px; }

        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            transition: background 0.2s;
        }

        button:hover { background-color: #eee; }
        button.active { background-color: var(--filled-color); color: white; border-color: var(--filled-color); }

        /* æ¸¸æˆå®¹å™¨å¸ƒå±€ */
        .game-container {
            display: grid;
            /* grid-template-columns will be set by JS based on size */
            gap: 1px;
            background-color: #999; /* ç½‘æ ¼çº¿é¢œè‰² */
            border: 2px solid var(--border-color);
            padding: 2px;
        }

        /* å•å…ƒæ ¼é€šç”¨æ ·å¼ */
        .cell, .header-col, .header-row {
            background-color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            box-sizing: border-box;
        }

        /* æç¤ºæ•°å­—åŒºåŸŸ */
        .header-col {
            flex-direction: column;
            justify-content: flex-end;
            padding-bottom: 4px;
            background-color: #e8e8e8;
            font-weight: bold;
            line-height: 1.2;
            white-space: pre-wrap; 
        }

        .header-row {
            flex-direction: row;
            justify-content: flex-end;
            padding-right: 8px;
            background-color: #e8e8e8;
            font-weight: bold;
            letter-spacing: 4px;
        }

        /* æ¸¸æˆæ ¼å­ */
        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            cursor: pointer;
            transition: background-color 0.1s;
        }

        .cell:hover { background-color: var(--highlight-color); }

        /* çŠ¶æ€æ ·å¼ */
        .cell.filled { background-color: var(--filled-color); }
        
        .cell.crossed::after {
            content: "Ã—";
            font-size: 24px;
            color: var(--x-color);
            line-height: 0;
        }

        /* æ¯5æ ¼åŠ ç²—è¾¹æ¡† (è¾…åŠ©çº¿) */
        .thick-right { border-right: 2px solid var(--border-color) !important; }
        .thick-bottom { border-bottom: 2px solid var(--border-color) !important; }

        .status {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            height: 24px;
        }
        
        .win { color: #27ae60; }

    </style>
</head>
<body>

    <h1>æ•°ç»‡ (Nonogram)</h1>
    
    <div class="controls">
        <button onclick="initGame(5)">5x5 (ç®€å•)</button>
        <button onclick="initGame(10)" class="active">10x10 (æ™®é€š)</button>
        <button onclick="initGame(15)">15x15 (å›°éš¾)</button>
        <button onclick="checkWin(true)">æ£€æŸ¥ç­”æ¡ˆ</button>
    </div>

    <div id="gameBoard" class="game-container"></div>
    <div id="statusMessage" class="status"></div>

    <div style="margin-top: 15px; font-size: 0.9em; color: #666;">
        <p>æ“ä½œè¯´æ˜ï¼š<b>å·¦é”®æ‹–æ‹½</b>å¡«è‰²ï¼Œ<b>å³é”®æ‹–æ‹½</b>æ ‡è®°å‰å·ã€‚</p>
    </div>

    <script>
        let gridSize = 10;
        let solution = [];
        let playerGrid = [];
        let isDragging = false;
        let dragType = null; // 'fill' or 'cross' or 'clear'
        
        const board = document.getElementById('gameBoard');
        const statusMsg = document.getElementById('statusMessage');

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame(size) {
            gridSize = size;
            statusMsg.innerText = "";
            statusMsg.className = "status";
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.controls button').forEach(btn => {
                // --- ä¿®æ”¹å¼€å§‹ ---
                // ä½¿ç”¨ parseInt æå–æŒ‰é’®æ–‡å­—å¼€å¤´çš„æ•°å­—ï¼ˆä¾‹å¦‚ "15x15" æå–å‡º 15ï¼‰
                // ç„¶åå’Œå½“å‰çš„ size è¿›è¡Œç²¾ç¡®æ¯”è¾ƒ
                if(parseInt(btn.innerText) === size) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
                // --- ä¿®æ”¹ç»“æŸ ---
            });

            generateSolution();
            playerGrid = Array(size).fill().map(() => Array(size).fill(0));
            renderBoard();
        }

        // ç”Ÿæˆéšæœºè°œé¢˜
        function generateSolution() {
            solution = [];
            for (let i = 0; i < gridSize; i++) {
                let row = [];
                for (let j = 0; j < gridSize; j++) {
                    // çº¦ 55% çš„æ¦‚ç‡å¡«è‰²ï¼Œé¿å…å¤ªç¨€ç–æˆ–å¤ªæ»¡
                    row.push(Math.random() > 0.45 ? 1 : 0);
                }
                solution.push(row);
            }
            // ç¡®ä¿ä¸æ˜¯ç©ºç›˜
            if (solution.every(row => row.every(cell => cell === 0))) {
                solution[0][0] = 1; 
            }
        }

        // è®¡ç®—è¡Œåˆ—æç¤º
        function calculateHints(arr) {
            let hints = [];
            let count = 0;
            for (let val of arr) {
                if (val === 1) {
                    count++;
                } else if (count > 0) {
                    hints.push(count);
                    count = 0;
                }
            }
            if (count > 0) hints.push(count);
            return hints.length > 0 ? hints : [0];
        }

        // æ¸²æŸ“æ¸¸æˆé¢æ¿
        function renderBoard() {
            board.innerHTML = '';
            
            // è®¾ç½® CSS Grid å¸ƒå±€ï¼š1åˆ—ç»™è¡Œæç¤ºï¼ŒNåˆ—ç»™æ ¼å­
            board.style.gridTemplateColumns = `auto repeat(${gridSize}, var(--cell-size))`;

            // 1. æ¸²æŸ“å·¦ä¸Šè§’ç©ºç™½å—
            const emptyCorner = document.createElement('div');
            emptyCorner.className = 'header-row';
            emptyCorner.style.background = '#ddd';
            board.appendChild(emptyCorner);

            // 2. æ¸²æŸ“é¡¶éƒ¨åˆ—æç¤º
            for (let c = 0; c < gridSize; c++) {
                let colData = solution.map(row => row[c]);
                let hints = calculateHints(colData);
                const th = document.createElement('div');
                th.className = 'header-col';
                // å°†æ•°å­—ç«–å‘æ’åˆ—
                th.innerHTML = hints.join('<br>'); 
                if ((c + 1) % 5 === 0 && c !== gridSize - 1) th.classList.add('thick-right');
                board.appendChild(th);
            }

            // 3. æ¸²æŸ“è¡Œæç¤º å’Œ æ¸¸æˆæ ¼å­
            for (let r = 0; r < gridSize; r++) {
                // è¡Œæç¤º
                let rowData = solution[r];
                let hints = calculateHints(rowData);
                const rh = document.createElement('div');
                rh.className = 'header-row';
                rh.innerText = hints.join(' ');
                if ((r + 1) % 5 === 0 && r !== gridSize - 1) rh.classList.add('thick-bottom');
                board.appendChild(rh);

                // æ¸¸æˆæ ¼å­
                for (let c = 0; c < gridSize; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.r = r;
                    cell.dataset.c = c;

                    // 5æ ¼åˆ†å‰²çº¿æ ·å¼
                    if ((c + 1) % 5 === 0 && c !== gridSize - 1) cell.classList.add('thick-right');
                    if ((r + 1) % 5 === 0 && r !== gridSize - 1) cell.classList.add('thick-bottom');

                    // é¼ æ ‡äº‹ä»¶
                    cell.addEventListener('mousedown', handleMouseDown);
                    cell.addEventListener('mouseenter', handleMouseEnter);
                    // ç¦ç”¨å³é”®èœå•
                    cell.addEventListener('contextmenu', (e) => e.preventDefault());

                    board.appendChild(cell);
                }
            }
        }

        // å¤„ç†é¼ æ ‡äº¤äº’
        function handleMouseDown(e) {
            e.preventDefault(); // é˜²æ­¢é»˜è®¤æ‹–æ‹½è¡Œä¸º
            isDragging = true;
            const r = parseInt(e.target.dataset.r);
            const c = parseInt(e.target.dataset.c);
            
            // ç¡®å®šæ“ä½œç±»å‹ï¼šå·¦é”®(0)å¡«è‰²ï¼Œå³é”®(2)æ‰“å‰
            // é€»è¾‘ï¼šå¦‚æœç‚¹çš„æ ¼å­å·²ç»æ˜¯å½“å‰é¢œè‰²ï¼Œåˆ™å˜ä¸ºæ“¦é™¤æ¨¡å¼
            const isRightClick = e.button === 2;
            const currentVal = playerGrid[r][c];
            
            if (isRightClick) {
                dragType = (currentVal === 2) ? 0 : 2; // 0æ˜¯æ¸…é™¤, 2æ˜¯X
            } else {
                dragType = (currentVal === 1) ? 0 : 1; // 0æ˜¯æ¸…é™¤, 1æ˜¯å¡«è‰²
            }

            updateCell(r, c);
        }

        function handleMouseEnter(e) {
            if (!isDragging) return;
            const r = parseInt(e.target.dataset.r);
            const c = parseInt(e.target.dataset.c);
            updateCell(r, c);
        }

        function updateCell(r, c) {
            if (isNaN(r) || isNaN(c)) return;
            
            // æ›´æ–°é€»è¾‘æ•°æ®
            playerGrid[r][c] = dragType;

            // æ›´æ–°è§†è§‰
            // æ‰¾åˆ°å¯¹åº”çš„DOMå…ƒç´  (æ³¨æ„ï¼šgridå¸ƒå±€ä¸­å­å…ƒç´ ç´¢å¼•ä¼šæœ‰åç§»)
            // Headerå äº† (gridSize + 1) ä¸ªï¼Œä¹‹åæ¯è¡Œç¬¬ä¸€ä¸ªæ˜¯Hint
            // è®¡ç®—è¾ƒä¸ºå¤æ‚ï¼Œä¸å¦‚ç›´æ¥Query
            const cell = document.querySelector(`.cell[data-r='${r}'][data-c='${c}']`);
            
            cell.classList.remove('filled', 'crossed');
            if (dragType === 1) cell.classList.add('filled');
            if (dragType === 2) cell.classList.add('crossed');
            
            // å®æ—¶ç®€å•æ£€æŸ¥ï¼ˆå¯é€‰ï¼Œè¿™é‡Œä»…ä½œä¸ºç¤ºä¾‹ï¼Œä¸è‡ªåŠ¨åˆ¤å®šï¼‰
            checkWin(false); 
        }

        // å…¨å±€æ¾å¼€é¼ æ ‡
        document.addEventListener('mouseup', () => {
            isDragging = false;
            dragType = null;
        });

        // æ£€æŸ¥èƒœåˆ©
        function checkWin(showError) {
            let isCorrect = true;
            let isComplete = true;

            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    const pVal = playerGrid[r][c] === 1 ? 1 : 0; // ç©å®¶çš„X(2)ç­‰åŒäº0
                    const sVal = solution[r][c];

                    if (pVal !== sVal) {
                        isCorrect = false;
                        // å¦‚æœæ˜¯â€œæ£€æŸ¥ç­”æ¡ˆâ€æ¨¡å¼ï¼Œä¸”ç©å®¶å¡«äº†è‰²ä½†å¡«é”™äº†ï¼Œå¯ä»¥æ ‡è®°ä¸€ä¸‹ï¼ˆè¿™é‡Œæš‚ä¸å®ç°å¤æ‚é”™è¯¯æç¤ºï¼‰
                    }
                }
            }

            if (isCorrect) {
                statusMsg.innerText = "æ­å–œï¼ä½ å®Œæˆäº†è°œé¢˜ï¼ğŸ‰";
                statusMsg.classList.add('win');
            } else {
                statusMsg.classList.remove('win');
                if (showError) {
                    statusMsg.innerText = "è¿˜æ²¡å¯¹å“¦ï¼Œå†æ£€æŸ¥ä¸€ä¸‹å§ã€‚";
                } else {
                    statusMsg.innerText = "";
                }
            }
        }

        // å¯åŠ¨é»˜è®¤æ¸¸æˆ
        initGame(10);

    </script>
</body>
</html>